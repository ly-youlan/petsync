<!-- pages/submitRecord/submitRecord.wxml -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <view class="header-content">
      <view class="title">æäº¤è®°å½•</view>
      <view class="subtitle" wx:if="{{assignment}}">{{assignment.petInfo.name}}</view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading">
      <view class="loading-icon"></view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <view class="form-container" wx:else>
    <!-- å® ç‰©ä¿¡æ¯ -->
    <view class="pet-info-card">
      <view class="pet-avatar">
        <image wx:if="{{assignment.petInfo.avatarUrl}}" src="{{assignment.petInfo.avatarUrl}}" mode="aspectFill"></image>
        <view wx:else class="default-avatar">ğŸˆ</view>
      </view>
      <view class="pet-details">
        <view class="pet-name">{{assignment.petInfo.name}}</view>
        <view class="pet-breed">{{assignment.petInfo.breed || 'æœªçŸ¥å“ç§'}}</view>
      </view>
      <view class="status-badge {{assignment.status}}">
        {{assignment.status === 'assigned' ? 'å¾…å¤„ç†' : 
          assignment.status === 'rejected' ? 'éœ€ä¿®æ”¹' : 
          assignment.status === 'submitted' ? 'å®¡æ ¸ä¸­' : 'æœªçŸ¥çŠ¶æ€'}}
      </view>
    </view>

    <!-- é€€å›åŸå›  -->
    <view class="rejection-card" wx:if="{{assignment.status === 'rejected' && assignment.comments}}">
      <view class="card-title">é€€å›åŸå› </view>
      <view class="rejection-content">{{assignment.comments}}</view>
    </view>

    <!-- è®°å½•å†…å®¹ -->
    <view class="form-card">
      <view class="card-title">è®°å½•å†…å®¹</view>
      <view class="textarea-container">
        <textarea 
          class="record-textarea" 
          placeholder="è¯·è¾“å…¥å® ç‰©çŠ¶æ€è®°å½•å†…å®¹..." 
          maxlength="{{maxCharacterCount}}" 
          bindinput="onInputRecord"
          value="{{recordContent}}"
        ></textarea>
        <view class="character-count">{{characterCount}}/{{maxCharacterCount}}</view>
      </view>
    </view>

    <!-- å›¾ç‰‡ä¸Šä¼  -->
    <view class="form-card">
      <view class="card-title">ä¸Šä¼ å›¾ç‰‡</view>
      <view class="upload-tip">å¯ä¸Šä¼ æœ€å¤š{{maxImageCount}}å¼ å›¾ç‰‡</view>
      
      <!-- å·²ä¸Šä¼ çš„äº‘ç«¯å›¾ç‰‡ -->
      <view class="image-list" wx:if="{{fileIDs.length > 0}}">
        <view class="image-item" wx:for="{{fileIDs}}" wx:key="*this">
          <image class="preview-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-src="{{item}}"></image>
          <view class="delete-btn" bindtap="deleteImage" data-index="{{index}}" data-type="cloud">Ã—</view>
        </view>
      </view>
      
      <!-- æ–°é€‰æ‹©çš„æœ¬åœ°å›¾ç‰‡ -->
      <view class="image-list" wx:if="{{tempFilePaths.length > 0}}">
        <view class="image-item" wx:for="{{tempFilePaths}}" wx:key="*this">
          <image class="preview-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-src="{{item}}"></image>
          <view class="delete-btn" bindtap="deleteImage" data-index="{{index}}" data-type="temp">Ã—</view>
        </view>
      </view>
      
      <!-- ä¸Šä¼ æŒ‰é’® -->
      <view class="upload-container" wx:if="{{fileIDs.length + tempFilePaths.length < maxImageCount}}">
        <view class="upload-btn" bindtap="chooseImage">
          <view class="upload-icon">+</view>
          <view class="upload-text">æ·»åŠ å›¾ç‰‡</view>
        </view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-container">
      <button class="cancel-btn" bindtap="goBack">å–æ¶ˆ</button>
      <button class="submit-btn" bindtap="submitRecord" disabled="{{submitting}}">
        {{submitting ? 'æäº¤ä¸­...' : 'æäº¤è®°å½•'}}
      </button>
    </view>
  </view>
</view>
