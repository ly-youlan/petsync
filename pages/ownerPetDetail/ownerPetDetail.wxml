<!--pages/ownerPetDetail/ownerPetDetail.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
  
  <!-- å® ç‰©ä¿¡æ¯ -->
  <view class="pet-header" wx:if="{{!loading && pet}}">
    <view class="pet-avatar">
      <block wx:if="{{pet.avatar}}">
        <image src="{{pet.avatar}}" mode="aspectFill"></image>
      </block>
      <block wx:else>
        <view class="default-pet-icon">
          <text>ğŸ¾</text>
        </view>
      </block>
    </view>
    <view class="pet-info">
      <!-- å® ç‰©åç§°å’ŒçŠ¶æ€ -->
      <view class="info-row">
        <view class="pet-name">{{pet.name}}</view>
        <view class="pet-status {{pet.status === 'ä½é™¢' ? 'status-hospitalized' : 'status-postop'}}">
          {{pet.status}}
        </view>
      </view>
      
      <!-- æ ‡ç­¾å·²éšè— -->
      <!-- æ ¹æ®éœ€æ±‚éšè—å® ç‰©æ ‡ç­¾ -->
      
      <!-- å® ç‰©å“ç§ -->
      <view class="info-row">
        <view class="info-item">
          <text class="item-label">å“ç§ï¼š</text>
          <text class="item-value">{{pet.breed || 'æœªçŸ¥'}}</text>
        </view>
      </view>
      
      <!-- å…¥é™¢åŸå›  -->
      <view class="info-row" wx:if="{{pet.reason}}">
        <view class="info-item">
          <text class="item-label">å…¥é™¢åŸå› ï¼š</text>
          <text class="item-value">{{pet.reason}}</text>
        </view>
      </view>
      
      <!-- è¯Šæ‰€ä¿¡æ¯ -->
      <view class="info-row">
        <view class="info-item">
          <text class="item-label">å°±è¯Šè¯Šæ‰€ï¼š</text>
          <text class="item-value">{{pet.clinicName || 'æœªçŸ¥è¯Šæ‰€'}}</text>
        </view>
      </view>
      
      <!-- åˆ›å»ºæ—¶é—´ -->
      <view class="info-row">
        <view class="info-item">
          <text class="item-label">åˆ›å»ºæ—¶é—´ï¼š</text>
          <text class="item-value time-value">{{pet.createTime}}</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ç§»é™¤äº†åˆ†äº«æŒ‰é’® -->
  <!-- å® ç‰©ä¸»äººç«¯ä¸éœ€è¦åˆ†äº«åŠŸèƒ½ -->
  
  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="section-title" wx:if="{{!loading && records.length > 0}}">
    <text class="title-text">å® ç‰©åŠ¨æ€</text>
    <view class="title-line"></view>
  </view>
  <view class="record-list" wx:if="{{!loading && records.length > 0}}">
    <view wx:for="{{records}}" wx:key="id" class="record-item">
      <view class="record-header">
        <view class="record-time-container">
          <text class="record-time">{{item.createdAt}}</text>
        </view>
        <text class="record-vet" wx:if="{{item.vetName}}">åŒ»ç”Ÿ: {{item.vetName}}</text>
      </view>
      <view class="record-content">
        <text>{{item.content}}</text>
      </view>
      <view class="record-images" wx:if="{{item.images && item.images.length > 0}}">
        <view 
          class="record-image-item" 
          wx:for="{{item.images}}" 
          wx:for-item="image" 
          wx:for-index="imageIndex"
          wx:key="*this"
          bindtap="previewImage"
          data-src="{{image}}"
          data-urls="{{item.images}}"
          data-index="{{imageIndex}}"
          data-clinic="{{pet.clinicName}}"
        >
          <image src="{{image}}" mode="aspectFill"></image>
          <!-- æ°´å°ç›´æ¥å åŠ åœ¨å›¾ç‰‡ä¸Š -->
          <view class="image-watermark" wx:if="{{pet.clinicName}}">
            <text>{{pet.clinicName}}</text>
          </view>
          <view class="image-zoom-hint">
            <text class="zoom-icon">+</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ²¡æœ‰è®°å½•æ—¶æ˜¾ç¤º -->
  <view class="empty-state" wx:if="{{!loading && emptyState}}">
    <view class="empty-icon">ğŸ¾</view>
    <view class="empty-text">è¿˜æ²¡æœ‰å® ç‰©åŠ¨æ€è®°å½•</view>
    <view class="empty-subtext">åŒ»ç”Ÿæ·»åŠ è®°å½•åå°†åœ¨è¿™é‡Œæ˜¾ç¤º</view>
    <view class="refresh-button" bindtap="loadPetDetail">åˆ·æ–°</view>
  </view>
  
  <!-- ä¸‹æ‹‰åˆ·æ–°æç¤º -->
  <view class="refresh-tip" wx:if="{{!loading && !emptyState && records.length > 0}}">
    <text>ä¸‹æ‹‰å¯åˆ·æ–°å® ç‰©åŠ¨æ€</text>
  </view>
  
  <!-- è¿”å›æŒ‰é’® -->
  <view class="back-button" bindtap="navigateBack">
    <text class="back-icon">â†</text>
  </view>
  
  <!-- è‡ªå®šä¹‰å›¾ç‰‡é¢„è§ˆç»„ä»¶ -->
  <view class="custom-preview" wx:if="{{showCustomPreview}}" bindtap="closeCustomPreview">
    <swiper class="preview-swiper" current="{{currentPreviewIndex}}" bindchange="previewSwiperChange">
      <swiper-item wx:for="{{previewImages}}" wx:key="*this">
        <view class="preview-image-container">
          <image src="{{item}}" mode="aspectFit" class="preview-image"></image>
          <!-- æ°´å°å§‹ç»ˆæ˜¾ç¤ºåœ¨é¢„è§ˆå›¾ç‰‡ä¸Š -->
          <view class="preview-watermark" wx:if="{{pet.clinicName}}">
            <text>{{pet.clinicName}}</text>
          </view>
        </view>
      </swiper-item>
    </swiper>
    <view class="preview-counter">{{currentPreviewIndex + 1}}/{{previewImages.length}}</view>
  </view>
</view>
