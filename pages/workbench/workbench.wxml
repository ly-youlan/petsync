<!--pages/workbench/workbench.wxml-->
<view class="container">
  <!-- 已审核通过的工作台 -->
  <block wx:if="{{isApproved}}">
    <view class="header-container">
      <view class="hospital-info">
        <mp-icon icon="info" color="#8B5A2B" size="{{24}}"></mp-icon>
        <view class="hospital-text">
          <view class="hospital-name">{{hospitalInfo.name}}</view>
          <view class="vet-name">兽医：{{userInfo.vetName || hospitalInfo.vetName}}</view>
        </view>
      </view>
      <view class="settings-btn" bindtap="goToSettings">
        <mp-icon icon="setting" color="#A67C52" size="{{24}}"></mp-icon>
        <text>设置</text>
      </view>
    </view>
    
    <view class="header">
      <view class="search-box">
        <input type="text" placeholder="搜索宠物名称/主人手机号" bindinput="search" />
        <view class="search-icon">
          <mp-icon icon="search" color="#D4B59E" size="{{22}}"></mp-icon>
        </view>
      </view>
      
      <view class="filters">
        <view wx:for="{{filters}}" wx:key="index" 
              class="filter {{item === currentFilter ? 'active' : ''}}"
              bindtap="changeFilter" data-filter="{{item}}">
          <text>{{item}}</text>
        </view>
      </view>
    </view>
    
    <!-- 创建新宠物记录按钮 -->
    <view class="create-btn" bindtap="goToCreatePetRecord">
      <mp-icon icon="add" color="#FFFFFF" size="{{24}}"></mp-icon>
      <text>创建新宠物记录</text>
    </view>
    
    <!-- 宠物记录列表 -->
    <view class="pet-records" wx:if="{{!loading && petRecords.length > 0}}">
      <view class="pet-card" wx:for="{{petRecords}}" wx:key="_id" bindtap="goToPetDetail" data-id="{{item._id}}">
        <view class="pet-image">
          <image src="{{item.petInfo.avatar || '/images/default-pet.png'}}" mode="aspectFill"></image>
        </view>
        <view class="pet-info">
          <view class="pet-name-row">
            <view class="pet-name">{{item.petInfo.name}}</view>
          </view>
          <view class="pet-breed">{{item.petInfo.breed}}</view>
          <view class="pet-status {{item.status === '住院' ? 'status-hospitalized' : 'status-postop'}}">
            <text>{{item.status}}</text>
          </view>
          <view class="pet-time">
            <text>{{item.createTime}}</text>
          </view>
        </view>
        <view class="pet-owner">
          <view class="owner-label">主人信息</view>
          <view class="owner-phone">{{item.ownerInfo.phoneNumber}}</view>
        </view>
        <view class="arrow">
          <mp-icon icon="more" color="#D4B59E" size="{{20}}"></mp-icon>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{!loading && petRecords.length === 0}}">
      <view class="empty-icon">
        <mp-icon icon="warn" color="#D4B59E" size="{{60}}"></mp-icon>
      </view>
      <view class="empty-text">暂无宠物记录</view>
      <view class="empty-subtext">点击上方按钮创建新的宠物记录</view>
      <view class="empty-action" bindtap="goToCreatePetRecord">
        <text>立即创建</text>
      </view>
    </view>
  </block>
  
  <!-- 待审核状态 -->
  <block wx:elif="{{!loading && !isApproved && hospitalInfo}}">
    <view class="pending-approval">
      <image src="/images/pending-approval.png" mode="aspectFit"></image>
      <view class="pending-title">审核中</view>
      <view class="pending-text">您的医院绑定信息正在审核中</view>
      <view class="hospital-card">
        <view class="hospital-title">医院信息</view>
        <view class="hospital-item">
          <view class="item-label">医院名称：</view>
          <view class="item-value">{{hospitalInfo.name}}</view>
        </view>
        <view class="hospital-item">
          <view class="item-label">医院地址：</view>
          <view class="item-value">{{hospitalInfo.address}}</view>
        </view>
        <view class="hospital-item">
          <view class="item-label">兽医姓名：</view>
          <view class="item-value">{{hospitalInfo.vetName}}</view>
        </view>
      </view>
      <view class="pending-subtext">请耐心等待管理员审核，审核通过后即可使用平台功能</view>
    </view>
  </block>
  
  <!-- 加载中 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-icon"></view>
    <view class="loading-text">加载中...</view>
  </view>
</view>
