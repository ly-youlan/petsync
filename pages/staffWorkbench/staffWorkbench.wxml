<!-- pages/staffWorkbench/staffWorkbench.wxml -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <view class="header-content">
      <view class="title">åŒ»æŠ¤å·¥ä½œå°</view>
      <view class="subtitle">{{clinicInfo.name || 'è¯Šæ‰€'}}</view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tabs">
    <view class="tab {{activeTab === 'pending' ? 'active' : ''}}" bindtap="switchTab" data-tab="pending">
      å¾…å¤„ç†ä»»åŠ¡
    </view>
    <view class="tab {{activeTab === 'completed' ? 'active' : ''}}" bindtap="switchTab" data-tab="completed">
      å†å²è®°å½•
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading">
      <view class="loading-icon"></view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:elif="{{emptyState}}">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-text">æš‚æ— åˆ†é…ä»»åŠ¡</view>
    <view class="empty-subtext">å…½åŒ»åˆ†é…ä»»åŠ¡åä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</view>
    <button class="refresh-btn" bindtap="refreshData">åˆ·æ–°</button>
  </view>

  <!-- å¾…å¤„ç†ä»»åŠ¡ -->
  <scroll-view scroll-y class="assignment-list" wx:elif="{{activeTab === 'pending'}}">
    <view wx:if="{{pendingTasksCount === 0}}" class="empty-tip">
      <view class="empty-icon">âœ“</view>
      <view class="empty-text">æš‚æ— å¾…å¤„ç†ä»»åŠ¡</view>
    </view>
    
    <view wx:for="{{assignments}}" wx:key="_id" wx:if="{{item.status === 'assigned' || item.status === 'rejected'}}"
          class="assignment-card">
      <view class="card-header">
        <view class="pet-info">
          <view class="pet-avatar">
            <image wx:if="{{item.petInfo.avatarUrl}}" src="{{item.petInfo.avatarUrl}}" mode="aspectFill"></image>
            <view wx:else class="default-avatar">ğŸˆ</view>
          </view>
          <view class="pet-details">
            <view class="pet-name">{{item.petInfo.name}}</view>
            <view class="pet-breed">{{item.petInfo.breed || 'æœªçŸ¥å“ç§'}}</view>
          </view>
        </view>
        <view class="status-badge {{item.status}}">
          {{item.status === 'assigned' ? 'å¾…å¤„ç†' : 'éœ€ä¿®æ”¹'}}
        </view>
      </view>
      
      <view class="card-content">
        <view class="assignment-time">
          åˆ†é…æ—¶é—´: {{item.createTime ? (item.createTime.toLocaleString ? item.createTime.toLocaleString() : item.createTime) : 'æœªçŸ¥'}}
        </view>
        
        <view class="comments" wx:if="{{item.status === 'rejected' && item.comments}}">
          <view class="comments-title">é€€å›åŸå› :</view>
          <view class="comments-content">{{item.comments}}</view>
        </view>
      </view>
      
      <view class="card-actions">
        <button class="action-btn view-btn" bindtap="viewPetDetail" data-petid="{{item.petId}}">æŸ¥çœ‹è¯¦æƒ…</button>
        <button class="action-btn submit-btn" bindtap="submitRecord" data-assignment="{{item}}">
          {{item.status === 'assigned' ? 'æäº¤è®°å½•' : 'é‡æ–°æäº¤'}}
        </button>
      </view>
    </view>
  </scroll-view>

  <!-- å†å²è®°å½• -->
  <scroll-view scroll-y class="assignment-list" wx:elif="{{activeTab === 'completed'}}">
    <view wx:if="{{historyTasksCount === 0}}" class="empty-tip">
      <view class="empty-icon">ğŸ“œ</view>
      <view class="empty-text">æš‚æ— å†å²è®°å½•</view>
    </view>
    
    <view wx:for="{{assignments}}" wx:key="_id" wx:if="{{item.status === 'submitted' || item.status === 'approved' || item.status === 'completed'}}"
          class="assignment-card">
      <view class="card-header">
        <view class="pet-info">
          <view class="pet-avatar">
            <image wx:if="{{item.petInfo.avatarUrl}}" src="{{item.petInfo.avatarUrl}}" mode="aspectFill"></image>
            <view wx:else class="default-avatar">ğŸˆ</view>
          </view>
          <view class="pet-details">
            <view class="pet-name">{{item.petInfo.name}}</view>
            <view class="pet-breed">{{item.petInfo.breed || 'æœªçŸ¥å“ç§'}}</view>
          </view>
        </view>
        <view class="status-badge {{item.status}}">
          {{item.status === 'submitted' ? 'å®¡æ ¸ä¸­' : 
            item.status === 'approved' ? 'å·²é€šè¿‡' : 
            item.status === 'completed' ? 'å·²å®Œæˆ' : 'æœªçŸ¥çŠ¶æ€'}}
        </view>
      </view>
      
      <view class="card-content">
        <view class="assignment-time">
          æäº¤æ—¶é—´: {{item.updateTime ? (item.updateTime.toLocaleString ? item.updateTime.toLocaleString() : item.updateTime) : 'æœªçŸ¥'}}
        </view>
        
        <view class="record-preview" wx:if="{{item.recordContent}}">
          <text class="record-text">{{item.recordContent.length > 50 ? item.recordContent.substring(0, 50) + '...' : item.recordContent}}</text>
        </view>
        
        <view class="approval-time" wx:if="{{item.approvalTime}}">
          å®¡æ ¸æ—¶é—´: {{item.approvalTime ? (item.approvalTime.toLocaleString ? item.approvalTime.toLocaleString() : item.approvalTime) : 'æœªçŸ¥'}}
        </view>
      </view>
      
      <view class="card-actions">
        <button class="action-btn view-btn" bindtap="viewPetDetail" data-petid="{{item.petId}}">æŸ¥çœ‹è¯¦æƒ…</button>
        <button class="action-btn submit-btn" wx:if="{{item.status === 'submitted'}}" bindtap="submitRecord" data-assignment="{{item}}">ä¿®æ”¹è®°å½•</button>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="footer">
    <button class="refresh-btn" bindtap="refreshData">åˆ·æ–°</button>
    <button class="back-btn" bindtap="goBack">è¿”å›</button>
  </view>
</view>
