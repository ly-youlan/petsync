<!-- pages/staffManagement/staffManagement.wxml -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <view class="header-content">
      <view class="title">åŒ»æŠ¤ç®¡ç†</view>
      <view class="subtitle">{{clinicInfo.name || 'è¯Šæ‰€'}}</view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tabs">
    <view class="tab {{activeTab === 'assign' ? 'active' : ''}}" bindtap="switchTab" data-tab="assign">
      åˆ†é…ä»»åŠ¡
    </view>
    <view class="tab {{activeTab === 'review' ? 'active' : ''}} {{pendingReviews > 0 ? 'has-badge' : ''}}" bindtap="switchTab" data-tab="review">
      å®¡æ ¸è®°å½•
      <view wx:if="{{pendingReviews > 0}}" class="badge">{{pendingReviews}}</view>
    </view>
  </view>

  <!-- åˆ†é…ä»»åŠ¡é¢æ¿ -->
  <view class="panel" wx:if="{{activeTab === 'assign'}}">
    <!-- å® ç‰©åˆ—è¡¨ -->
    <view class="section">
      <view class="section-title">é€‰æ‹©å® ç‰©</view>
      <scroll-view scroll-y class="pet-list">
        <view wx:if="{{petRecords.length === 0}}" class="empty-tip">æš‚æ— å® ç‰©è®°å½•</view>
        <view wx:for="{{petRecords}}" wx:key="_id" 
              class="pet-item {{selectedPetId === item._id ? 'selected' : ''}}" 
              bindtap="selectPet" data-id="{{item._id}}">
          <view class="pet-avatar">
            <image wx:if="{{item.petInfo.avatarUrl}}" src="{{item.petInfo.avatarUrl}}" mode="aspectFill"></image>
            <view wx:else class="default-avatar">ğŸˆ</view>
          </view>
          <view class="pet-info">
            <view class="pet-name">{{item.petInfo.name}}</view>
            <view class="pet-breed">{{item.petInfo.breed || 'æœªçŸ¥å“ç§'}}</view>
            <view class="pet-owner">ä¸»äºº: {{item.ownerInfo.name || 'æœªçŸ¥'}} ({{item.ownerInfo.phoneNumber}})</view>
          </view>
          <view class="pet-status" wx:if="{{item.assignedToStaff}}">å·²åˆ†é…</view>
        </view>
      </scroll-view>
    </view>

    <!-- åŒ»æŠ¤äººå‘˜åˆ—è¡¨ -->
    <view class="section">
      <view class="section-title">é€‰æ‹©åŒ»æŠ¤äººå‘˜</view>
      <scroll-view scroll-y class="staff-list">
        <view wx:if="{{staffList.length === 0}}" class="empty-tip">æš‚æ— åŒ»æŠ¤äººå‘˜</view>
        <view wx:for="{{staffList}}" wx:key="openid" 
              class="staff-item {{selectedStaffId === item.openid ? 'selected' : ''}}" 
              bindtap="selectStaff" data-id="{{item.openid}}">
          <view class="staff-avatar">
            <image wx:if="{{item.avatarUrl}}" src="{{item.avatarUrl}}" mode="aspectFill"></image>
            <view wx:else class="default-avatar">ğŸ‘©â€âš•ï¸</view>
          </view>
          <view class="staff-info">
            <view class="staff-name">{{item.name}}</view>
            <view class="staff-phone">{{item.phoneNumber || 'æ— ç”µè¯'}}</view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- åˆ†é…æŒ‰é’® -->
    <view class="action-section">
      <button class="assign-btn" bindtap="assignPet" disabled="{{!selectedPetId || !selectedStaffId}}">åˆ†é…ä»»åŠ¡</button>
    </view>
  </view>

  <!-- å®¡æ ¸è®°å½•é¢æ¿ -->
  <view class="panel" wx:if="{{activeTab === 'review'}}">
    <view class="section">
      <view class="section-title">å¾…å®¡æ ¸è®°å½•</view>
      <scroll-view scroll-y class="assignment-list">
        <view wx:if="{{pendingReviews === 0}}" class="empty-tip">æš‚æ— å¾…å®¡æ ¸è®°å½•</view>
        <view wx:for="{{assignments}}" wx:key="_id" wx:if="{{item.status === 'submitted'}}"
              class="assignment-item" bindtap="reviewRecord" data-assignment="{{item}}">
          <view class="assignment-header">
            <view class="pet-avatar">
              <image wx:if="{{item.petInfo.avatarUrl}}" src="{{item.petInfo.avatarUrl}}" mode="aspectFill"></image>
              <view wx:else class="default-avatar">ğŸˆ</view>
            </view>
            <view class="assignment-info">
              <view class="pet-name">{{item.petInfo.name}}</view>
              <view class="pet-breed">{{item.petInfo.breed || 'æœªçŸ¥å“ç§'}}</view>
            </view>
            <view class="status-badge submitted">å¾…å®¡æ ¸</view>
          </view>
          <view class="assignment-content">
            <view class="staff-info">åŒ»æŠ¤: {{item.staffInfo.name}}</view>
            <view class="submit-time">æäº¤æ—¶é—´: {{item.updateTime ? (item.updateTime.toLocaleString ? item.updateTime.toLocaleString() : item.updateTime) : 'æœªçŸ¥'}}</view>
          </view>
        </view>
      </scroll-view>
    </view>

    <view class="section">
      <view class="section-title">å†å²è®°å½•</view>
      <scroll-view scroll-y class="assignment-list">
        <view wx:if="{{historyRecords === 0}}" class="empty-tip">æš‚æ— å†å²è®°å½•</view>
        <view wx:for="{{assignments}}" wx:key="_id" wx:if="{{item.status !== 'submitted'}}"
              class="assignment-item" bindtap="reviewRecord" data-assignment="{{item}}">
          <view class="assignment-header">
            <view class="pet-avatar">
              <image wx:if="{{item.petInfo.avatarUrl}}" src="{{item.petInfo.avatarUrl}}" mode="aspectFill"></image>
              <view wx:else class="default-avatar">ğŸˆ</view>
            </view>
            <view class="assignment-info">
              <view class="pet-name">{{item.petInfo.name}}</view>
              <view class="pet-breed">{{item.petInfo.breed || 'æœªçŸ¥å“ç§'}}</view>
            </view>
            <view class="status-badge {{item.status}}">
              {{item.status === 'assigned' ? 'å·²åˆ†é…' : 
                item.status === 'approved' ? 'å·²é€šè¿‡' : 
                item.status === 'rejected' ? 'å·²é€€å›' : 
                item.status === 'completed' ? 'å·²å®Œæˆ' : 'æœªçŸ¥çŠ¶æ€'}}
            </view>
          </view>
          <view class="assignment-content">
            <view class="staff-info">åŒ»æŠ¤: {{item.staffInfo.name}}</view>
            <view class="submit-time">æ›´æ–°æ—¶é—´: {{item.updateTime ? (item.updateTime.toLocaleString ? item.updateTime.toLocaleString() : item.updateTime) : 'æœªçŸ¥'}}</view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="footer">
    <button class="back-btn" bindtap="goBack">è¿”å›å·¥ä½œå°</button>
  </view>
</view>
